<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="content-type" content="text/html; charset=gbk">

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<title> JNI编程 ―― 让C++和Java相互调用_iibull-ChinaUnix博客</title>
<meta name="description" content="JNI其实是Java NativeInterface的简称,也就是java本地接口。它提供了若干的API实现了和Java和其他语言的通信（主要是C&amp;ampC++）。也许不少人觉得Java已经足够强大，为什么要需要JNI这种东西呢？我们知道Java是一种平台无关性的语言，平台对于上层的java代码来"><script src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/ga.js" async="" type="text/javascript"></script><script language="javascript" type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/script_cookie.js"></script>
<script language="javascript" type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/script_common.js"></script>
<script language="javascript" type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/script_menu.js"></script>
<script language="javascript" type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/script_ajax.js"></script>
<script language="javascript" type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/script_face.js"></script>
<script language="javascript" type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/script_manage.js"></script>
<link rel="StyleSheet" href="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/style.css" type="text/css" media="screen">
 
<link rel="StyleSheet" href="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/default.css" type="text/css" media="screen">
</head>
<body><script charset="utf-8" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/jiathis.php"></script><link type="text/css" rel="stylesheet" href="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/jiathis_share.css"><iframe style="position: fixed; display: none; opacity: 0;" frameborder="0"></iframe><div style="position: absolute; z-index: 1000000000; display: none; top: 50%; left: 50%; overflow: auto;" id="ckepop"></div><div style="position: absolute; z-index: 1000000000; display: none; overflow: auto;" id="ckepop"></div><iframe src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/jiathis_utility.htm" style="display: none;" frameborder="0"></iframe>

<style type="text/css">
@import url(http://blog.chinaunix.net/css/nav.css);
</style>

<div class="login">
<div class="Content">
<div class="l1" id="ll">

<a href="http://www.chinaunix.net/" target="_blank">CU首页</a>
<a href="http://blog.chinaunix.net/link.php?url=http://bbs.chinaunix.net" title="CU论坛" target="_blank">CU论坛首页</a>
<a href="http://blog.chinaunix.net/link.php?url=http://blog.chinaunix.net" title="CU博客" target="_blank">CU博客首页</a>   ┊ 
<a href="http://blog.chinaunix.net/do.php?ac=wuxingzypcw213">登录</a>
<a href="http://blog.chinaunix.net/do.php?ac=8f442ba1e0c79cd3efcd1fd42b8aad8e">注册</a>
   ┊    
<a href="http://blog.chinaunix.net/network.php">随便看看</a>
</div>
<div class="r1">
<form action="/cp.php" method="get">
    <input name="ac" id="ac" value="search" type="hidden">
<input class="btn1" style="margin-bottom:0px;" value="" type="submit">
<select name="searchType" id="searchType" style="line-height: 13px;margin-bottom:0px;padding:0px;height:21px;">
<option selected="selected" value="blog">博文</option>
<option value="friend">博主</option>
<option value="album">相册</option>
<option value="poll">投票</option>
<option value="event">活动</option>
</select>
<input class="inp1" name="searchkey" id="searchkey" style="margin-bottom:0px;" type="text">
<a href="http://blog.chinaunix.net/cp.php?ac=blog" class="a1">发博文</a>
</form>
</div>
</div>
</div>

<ul id="ucappmenu_menu" class="dropmenu_drop" style="display:none;">
<li><a href="http://blog.chinaunix.net/link.php?url=http://bbs.chinaunix.net" title="CU论坛" target="_blank">CU论坛首页</a></li>
<li><a href="http://blog.chinaunix.net/link.php?url=http://blog.chinaunix.net" title="CU博客" target="_blank">CU博客首页</a></li>
</ul>


<div id="append_parent" style="z-index:99999;"></div>
<div id="ajaxwaitid"></div>
<span id="pageSet"></span>
<div class="Content" id="Content">
<div class="top" id="top" style=" position:relative;">
    <div class="tm"><a href="http://blog.chinaunix.net/link.php?url=http%3A%2F%2Fblog.chinaunix.net%2Fuid-24789255-id-3284325.html%26stats%3Dclick" target="_blank">公告：“Jolt大奖精选丛书”有奖征文活动</a></div>
<div class="addr">
       			<b id="home_title">牛蹄印章</b>
   	 <p>
<a href="http://blog.chinaunix.net/uid/27875.html">http://blog.chinaunix.net/space.php?uid=27875</a>
</p>
<span id="blog_brief">
<span id="blog_b">阿牛是个好青年</span>&nbsp;&nbsp;&nbsp;
</span>
<div id="blog_brief_form" style="display:none; height:auto;">
 		<form id="brief_form" method="post" action="/do.php?ac=ajax&amp;op=blog_brief">
              			<input id="blog_brief" name="blog_brief" value="阿牛是个好青年" size="50" style="margin-bottom:0px;" type="text">
             			<input onclick="checkBbrief();" value="提交" class="submit" style="height:20px;margin-bottom:0px;" type="button">&nbsp;
            			<input name="formhash" value="db43b4fc" type="hidden">
              			<input value="取消" class="submit" style="height:20px;margin-bottom:0px;" onclick="s('blog_brief');h('blog_brief_form');" type="button">
             		 </form>
</div>
             
<!-- 徽章定位3 -->
</div>
<div class="daoh">
<a href="http://blog.chinaunix.net/uid/27875.html">首页</a> | 
<a href="http://blog.chinaunix.net/uid/27875/frmd/-1.html" class="here" ;="">博文目录</a>  |  
<a href="http://blog.chinaunix.net/space.php?do=album&amp;view=me&amp;uid=27875">相册</a>  |  
<a href="http://blog.chinaunix.net/group.php" target="_blank">博客圈</a>  |
<a href="http://blog.chinaunix.net/space.php?do=profile&amp;uid=27875">关于我</a>  |
<a href="http://blog.chinaunix.net/space.php?do=profile&amp;uid=27875#comment">留言</a>
</div>
</div>
<link href="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/fck_editorarea.css" rel="stylesheet" type="text/css">
<div class="l2 ">	
<!-- 个人资料 -->
<div class="bor1 mt10" id="profile">
<div class="tit1">个人资料</div>
<div class="Img dingwei_img1"><a href="http://blog.chinaunix.net/uid/27875.html"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/75_avatar_big.jpg" onerror="this.onerror=null;this.src='http://passport.ixpub.net/images/noavatar_big.gif'"></a>
</div>
<div class="Text">
<div class="p1">
<a href="http://blog.chinaunix.net/uid/27875.html">iibull</a>
   		   		</div>
<div class="p3" style="height:38px;">
 <a href="http://blog.chinaunix.net/space.php?do=doing&amp;view=me&amp;uid=27875" target="_blank">微博</a>
 <a href="http://bbs.chinaunix.net/" target="_blank">论坛</a>
</div>
<div class="p3"> 
 <a href="http://blog.chinaunix.net/cp.php?ac=pm&amp;uid=27875" id="a_pm" onclick="ajaxmenu(event, this.id, 1)">发纸条</a> 
 <a href="http://blog.chinaunix.net/cp.php?ac=poke&amp;op=send&amp;uid=27875" id="a_poke" onclick="ajaxmenu(event, this.id, 1)">打招呼</a>
 <span id="attention"><a href="javascript:;" onclick="attention(27875 , 'add');">加关注</a></span>
   <a href="http://blog.chinaunix.net/cp.php?ac=friend&amp;op=add&amp;uid=27875" id="a_friend_li" onclick="ajaxmenu(event, this.id, 1)">加好友</a>
 </div>

<div class="list1">
<ul>
<li>博客访问：782585</li>
<li>博文数量：724</li>
<li>博客积分：12136</li>
<li>博客等级：<a href="http://blog.chinaunix.net/cp.php?ac=credit&amp;op=usergroup">上将</a> </li>
<li>关注人气： 17</li>
<li>注册时间：2009-01-09 11:25:16</li>
</ul>
</div>
</div>
</div>

<!-- 文章分类 -->
<div class="bor1 mt10" id="blist">
<div class="tit1">文章分类</div>
<div class="allla">
<div class="alll"><a href="http://blog.chinaunix.net/uid/27875/frmd/-1.html">全部博文<b>(724)</b></a></div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41275.html" title="linux设备驱动第三版-学习日志">linux设备驱动第三版-学习日志(33)</a></div>
<div style="display:none;" id="DIV_41275" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41274.html" title="原创">原创(17)</a></div>
<div style="display:none;" id="DIV_41274" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41273.html" title="ARMLINUX技术文摘">ARMLINUX技术文摘(3)</a></div>
<div style="display:none;" id="DIV_41273" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list41.gif" id="41267" onclick="opDIV(this.id);" style="cursor:pointer;"><a href="http://blog.chinaunix.net/uid/27875/frmd/41267.html" title="Porting">Porting(52)</a></div>
<div style="display:none;" id="DIV_41267" class="alll3">
<div class="alll4"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41267/fup/41272.html" title="Porting">Delphi(9)</a></div>
<div class="alll4"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41267/fup/41271.html" title="Porting">dotNet(10)</a></div>
<div class="alll4"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41267/fup/41270.html" title="Porting">Meego(1)</a></div>
<div class="alll4"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41267/fup/41269.html" title="Porting">Kernel(23)</a></div>
<div class="alll4"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41267/fup/41268.html" title="Porting">U-BOOT(7)</a></div>
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41266.html" title="代码分析">代码分析(1)</a></div>
<div style="display:none;" id="DIV_41266" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41265.html" title="移植">移植(7)</a></div>
<div style="display:none;" id="DIV_41265" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41264.html" title="sysfs 全接触">sysfs 全接触(1)</a></div>
<div style="display:none;" id="DIV_41264" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41263.html" title="skyeye">skyeye(1)</a></div>
<div style="display:none;" id="DIV_41263" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41262.html" title="音视频">音视频(1)</a></div>
<div style="display:none;" id="DIV_41262" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list41.gif" id="41260" onclick="opDIV(this.id);" style="cursor:pointer;"><a href="http://blog.chinaunix.net/uid/27875/frmd/41260.html" title="android">android(30)</a></div>
<div style="display:none;" id="DIV_41260" class="alll3">
<div class="alll4"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41260/fup/41261.html" title="android">Oracle(15)</a></div>
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41259.html" title="wince">wince(13)</a></div>
<div style="display:none;" id="DIV_41259" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41258.html" title="linux 驱动">linux 驱动(20)</a></div>
<div style="display:none;" id="DIV_41258" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41257.html" title="前沿文摘">前沿文摘(25)</a></div>
<div style="display:none;" id="DIV_41257" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41256.html" title="GTK">GTK(19)</a></div>
<div style="display:none;" id="DIV_41256" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list41.gif" id="41254" onclick="opDIV(this.id);" style="cursor:pointer;"><a href="http://blog.chinaunix.net/uid/27875/frmd/41254.html" title="杂项">杂项(19)</a></div>
<div style="display:none;" id="DIV_41254" class="alll3">
<div class="alll4"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41254/fup/41255.html" title="杂项">工作(6)</a></div>
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41253.html" title="日志">日志(17)</a></div>
<div style="display:none;" id="DIV_41253" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41252.html" title="娱乐">娱乐(24)</a></div>
<div style="display:none;" id="DIV_41252" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41251.html" title="linux 系统">linux 系统(50)</a></div>
<div style="display:none;" id="DIV_41251" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41250.html" title="linux 应用">linux 应用(64)</a></div>
<div style="display:none;" id="DIV_41250" class="alll3">
</div>
<div class="alll1"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/list3.gif"><a href="http://blog.chinaunix.net/uid/27875/frmd/41249.html" title="armlinux">armlinux(94)</a></div>
<div style="display:none;" id="DIV_41249" class="alll3">
</div>
<div class="alll"><a href="http://blog.chinaunix.net/uid/27875/frmd/0.html">未分类博文(233)</a></div>
</div>
</div>
<script>
function opDIV(id){
if(document.getElementById('DIV_'+id).style.display=='none'){
document.getElementById('DIV_'+id).style.display='block';
document.getElementById(id).src="/image/list4.gif";
}else{
document.getElementById('DIV_'+id).style.display='none';
document.getElementById(id).src="/image/list41.gif";
}
}
</script>


<!-- 订阅我的博客 -->
<div class="bor1 mt10" id="rss">
<div class="tit1">订阅我的博客</div>
<ul class="list3">
<li><a href="http://blog.chinaunix.net/rss.php?uid=27875"><img alt="订阅" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/feedsky.gif" height="16" width="49"></a></li>
<li><a target="_blank" href="http://www.xianguo.com/subscribe.php?url=http://home.chinaunix.com/rss.php?uid=27875"><img alt="订阅到鲜果" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/d2.png" border="0"></a></li>
<li><a target="_blank" href="http://www.zhuaxia.com/add_channel.php?url=http://home.chinaunix.com/rss.php?uid=27875"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/d3.png" alt="订阅到抓虾" height="16" width="103" border="0"></a></li>
<li><a target="_blank" href="http://fusion.google.com/add?feedurl=http://home.chinaunix.com/rss.php?uid=27875"><img src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/d4.png" alt="订阅到Google" height="16" width="103" border="0"></a></li>
</ul>
</div>


<!-- 好友 -->

<!-- 最近来访 -->
</div>
<div class="r2" id="blog_center" style="position:relative">
<!-- 博文 -->
<div class="bor1 mt10">
<div class="tit5"><span>字体大小：<a href="javascript:;" onclick="doZoom('16');" id="font_16">大</a> <a style="font-weight: bold;" href="javascript:;" onclick="doZoom('14');" id="font_14">中</a> <a href="javascript:;" onclick="doZoom('12');" id="font_12">小</a></span>博文</div>
<div class="text">
<div class="tit6">
<a href="javascript:;">JNI编程 ―― 让C++和Java相互调用</a> 
(2009-09-28 15:26)
	
</div>
<div class="tit7">
</div>
<br>
<br>
<div id="detail" class="detail" style="line-height: 1.3;"><p></p><p>JNI其实是Java Native
Interface的简称,也就是java本地接口。它提供了若干的API实现了和Java和其他语言的通信（主要是C&amp;C++）。也许不少人觉
得Java已经足够强大，为什么要需要JNI这种东西呢？我们知道Java是一种平台无关性的语言，平台对于上层的java代码来说是透明的，所以在多数
时间我们是不需要JNI的，但是假如你遇到了如下的三种情况之一呢？</p>
<p>&nbsp;</p>
<ol><li>你的Java代码，需要得到一个文件的属性。但是你找遍了JDK帮助文档也找不到相关的API。</li><li>在本地还有一个别的系统，不过他不是Java语言实现的，这个时候你的老板要求你把两套系统整合到一起。</li><li>你的Java代码中需要用到某种算法，不过算法是用C实现并封装在动态链接库文件（DLL）当中的。<br>
</li></ol>
<p>对于上述的三种情况，如果没有JNI的话，那就会变得异常棘手了。就算找到解决方案了，也是费时费力。其实说到底还是会增加开发和维护的成本。</p>
<p>&nbsp;</p>
<p>说了那么多一通废话，现在进入正题。看过JDK源代码的人肯定会注意到在源码里有很多标记成native的方法。这些个方法只有方法签名但是没有方
法体。其实这些naive方法就是我们说的 java native
interface。他提供了一个调用（invoke）的接口，然后用C或者C++去实现。我们首先来编写这个“桥梁”.我自己的开发环境是
j2sdk1.4.2_15 + eclipse 3.2 + VC++
6.0，先在eclipse里建立一个HelloFore的Java工程，然后编写下面的代码。</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Java代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=package%20com.chnic.jni%3B%0A%0Apublic%20class%20SayHellotoCPP%20%7B%0A%09%0A%09public%20SayHellotoCPP()%7B%0A%09%7D%0A%09public%20native%20void%20sayHello(String%20name)%3B%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-j" start="1"><li><span><span class="keyword">package</span><span>&nbsp;com.chnic.jni;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;SayHellotoCPP&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;SayHellotoCPP(){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">native</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;sayHello(String&nbsp;name);&nbsp;&nbsp;</span></span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="java">package com.chnic.jni;

public class SayHellotoCPP {
	
	public SayHellotoCPP(){
	}
	public native void sayHello(String name);
}</pre>
<p>&nbsp;</p>
<p>&nbsp;一般的第一个程序总是HelloWorld。今天换换口味，把world换成一个名字。我的native本地方法有一个String的参数。会传
递一个name到后台去。本地方法已经完成，现在来介绍下javah这个方法，接下来就要用javah方法来生成一个相对应的.h头文件。</p>
<p>&nbsp;</p>
<p>javah是一个专门为JNI生成头文件的一个命令。CMD打开控制台之后输入javah回车就能看到javah的一些参数。在这里就不多介绍
我们要用的是
-jni这个参数，这个参数也是默认的参数，他会生成一个JNI式的.h头文件。在控制台进入到工程的根目录，也就是HelloFore这个目录，然后输
入命令。</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Java代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=javah%20-jni%20com.chnic.jni.SayHellotoCPP" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-j" start="1"><li><span><span>javah&nbsp;-jni&nbsp;com.chnic.jni.SayHellotoCPP&nbsp;&nbsp;</span></span></li></ol></div><pre style="display: none;" name="code" class="java">javah -jni com.chnic.jni.SayHellotoCPP</pre>
<p>&nbsp;</p>
<p>命令执行完之后在工程的根目录就会发现<strong>com_chnic_jni_SayHellotoCPP.h</strong>
这个头文件。在这里有必要多句嘴，在执行javah的时候，要输入完整的包名+类名。否则在以后的测试调用过程中会发生java.lang.UnsatisfiedLinkError这个异常。</p>
<p>&nbsp;</p>
<p>到这里java部分算是基本完成了，接下来我们来编写后端的C++代码。（用C也可以，只不过cout比printf用起来更快些，所以这里俺偷下
懒用C++）打开VC++首先新建一个Win32 Dynamic-Link library工程，之后选择An empty DLL
project空工程。在这里我C++的工程是HelloEnd，把刚刚生成的那个头文件拷贝到这个工程的根目录里。随便用什么文本编辑器打开这个头文
件，发现有一个如下的方法签名。</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Cpp代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=%2F*%0A%20*%20Class%3A%20%20%20%20%20com_chnic_jni_SayHellotoCPP%0A%20*%20Method%3A%20%20%20%20sayHello%0A%20*%20Signature%3A%20(Ljava%2Flang%2FString%3B)V%0A%20*%2F%0AJNIEXPORT%20void%20JNICALL%20Java_com_chnic_jni_SayHellotoCPP_sayHello%0A%20%20(JNIEnv%20*%2C%20jobject%2C%20jstring)%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-cpp" start="1"><li><span><span class="comment">/*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Class:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com_chnic_jni_SayHellotoCPP</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Method:&nbsp;&nbsp;&nbsp;&nbsp;sayHello</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Signature:&nbsp;(Ljava/lang/String;)V</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>JNIEXPORT&nbsp;<span class="keyword">void</span><span>&nbsp;JNICALL&nbsp;Java_com_chnic_jni_SayHellotoCPP_sayHello&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;(JNIEnv&nbsp;*,&nbsp;jobject,&nbsp;jstring);&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="cpp">/*
 * Class:     com_chnic_jni_SayHellotoCPP
 * Method:    sayHello
 * Signature: (Ljava/lang/String;)V
 */
JNIEXPORT void JNICALL Java_com_chnic_jni_SayHellotoCPP_sayHello
  (JNIEnv *, jobject, jstring);</pre>
<p>&nbsp;</p>
<p>仔细观察一下这个方法，在注释上标注类名、方法名、签名（Signature），至于这个签名是做什么用的，我们以后再说。在这里最重要的是
Java_com_chnic_jni_SayHellotoCPP_sayHello这个方法签名。在Java端我们执行
sayHello(String
name)这个方法之后，JVM就会帮我们唤醒在DLL里的Java_com_chnic_jni_SayHellotoCPP_sayHello这个方
法。因此我们新建一个C++ source file来实现这个方法。</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Cpp代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=%23include%20%3Ciostream.h%3E%0A%23include%20%22com_chnic_jni_SayHellotoCPP.h%22%0A%0A%0AJNIEXPORT%20void%20JNICALL%20Java_com_chnic_jni_SayHellotoCPP_sayHello%20%0A%20%20(JNIEnv*%20env%2C%20jobject%20obj%2C%20jstring%20name)%0A%7B%0A%09const%20char*%20pname%20%3D%20env-%3EGetStringUTFChars(name%2C%20NULL)%3B%0A%09cout%20%3C%3C%20%22Hello%2C%20%22%20%3C%3C%20pname%20%3C%3C%20endl%3B%0A%7D%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-cpp" start="1"><li><span><span class="preprocessor">#include&nbsp;&lt;iostream.h&gt;</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="preprocessor">#include&nbsp;"com_chnic_jni_SayHellotoCPP.h"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>JNIEXPORT&nbsp;<span class="keyword">void</span><span>&nbsp;JNICALL&nbsp;Java_com_chnic_jni_SayHellotoCPP_sayHello&nbsp;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;(JNIEnv*&nbsp;env,&nbsp;jobject&nbsp;obj,&nbsp;jstring&nbsp;name)&nbsp;&nbsp;</span></li><li><span>{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span><span>&nbsp;</span><span class="datatypes">char</span><span>*&nbsp;pname&nbsp;=&nbsp;env-&gt;GetStringUTFChars(name,&nbsp;NULL);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;<span class="string">"Hello,&nbsp;"</span><span>&nbsp;&lt;&lt;&nbsp;pname&nbsp;&lt;&lt;&nbsp;endl;&nbsp;&nbsp;</span></span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="cpp">#include &lt;iostream.h&gt;
#include "com_chnic_jni_SayHellotoCPP.h"


JNIEXPORT void JNICALL Java_com_chnic_jni_SayHellotoCPP_sayHello 
  (JNIEnv* env, jobject obj, jstring name)
{
	const char* pname = env-&gt;GetStringUTFChars(name, NULL);
	cout &lt;&lt; "Hello, " &lt;&lt; pname &lt;&lt; endl;
}
</pre>
<p>&nbsp;</p>
<p>因为我们生成的那个头文件是在C++工程的根目录不是在环境目录，所以我们要把尖括号改成单引号，至于VC++的环境目录可以在
Tools-&gt;Options-&gt;Directories里设置。F7编译工程发现缺少jni.h这个头文件。这个头文件可以
在%JAVA_HOME%\include目录下找到。把这个文件拷贝到C++工程目录，继续编译发现还是找不到。原来是因为在我们刚刚生成的那个头文件
里，jni.h这个文件是被 #include &lt;jni.h&gt;引用进来的，因此我们把尖括号改成双引号#include
"jni.h"，继续编译发现少了jni_md.h文件，接着在%JAVA_HOME%\include\win32下面找到那个头文件，放入到工程根目
录，F7编译成功。在Debug目录里会发现生成了HelloEnd.dll这个文件。</p>
<p>&nbsp;</p>
<p>这个时候后端的C++代码也已经完成，接下来的任务就是怎么把他们连接在一起了，要让前端的java程序“认识并找到”这个动态链接库，就必须把这个DLL放在windows path环境变量下面。有两种方法可以做到：</p>
<p>&nbsp;</p>
<ol><li>把这个DLL放到windows下面的sysytem32文件夹下面，这个是windows默认的path</li><li>复制你工程的Debug目录，我这里是C:\Program Files\Microsoft Visual Studio\MyProjects\HelloEnd\Debug这个目录，把这个目录配置到User variable的Path下面。<span style="color: rgb(255, 0, 0);">重启eclipse，让eclipse在启动的时候重新读取这个path变量。</span>
</li></ol>
<p>&nbsp;</p>
<p>比较起来，第二种方法比较灵活，在开发的时候不用来回copy
dll文件了，节省了很多工作量，所以在开发的时候推荐用第二种方法。在这里我们使用的也是第二种，eclipse重启之后打开
SayHellotoCPP这个类。其实我们上面做的那些是不是是让JVM能找到那些DLL文件，接下来我们要让我们自己的java代码“认识”这个动态
链接库。加入System.loadLibrary("HelloEnd");这句到静态初始化块里。</p>
<p>&nbsp;</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Java代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=package%20com.chnic.jni%3B%0A%0Apublic%20class%20SayHellotoCPP%20%7B%0A%09%0A%09static%7B%0A%09%09System.loadLibrary(%22HelloEnd%22)%3B%0A%09%7D%0A%09public%20SayHellotoCPP()%7B%0A%09%7D%0A%09public%20native%20void%20sayHello(String%20name)%3B%0A%09%0A%7D%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-j" start="1"><li><span><span class="keyword">package</span><span>&nbsp;com.chnic.jni;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;SayHellotoCPP&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.loadLibrary(<span class="string">"HelloEnd"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;SayHellotoCPP(){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">native</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;sayHello(String&nbsp;name);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="java">package com.chnic.jni;

public class SayHellotoCPP {
	
	static{
		System.loadLibrary("HelloEnd");
	}
	public SayHellotoCPP(){
	}
	public native void sayHello(String name);
	
}
</pre>
<p>&nbsp;</p>
<p>这样我们的代码就能认识并加载这个动态链接库文件了。万事俱备，只欠测试代码了，接下来编写测试代码。</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Java代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=%09%09SayHellotoCPP%20shp%20%3D%20new%20SayHellotoCPP()%3B%0A%09%09shp.sayHello(%22World%22)%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-j" start="1"><li><span><span>SayHellotoCPP&nbsp;shp&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;SayHellotoCPP();&nbsp;&nbsp;</span></span></li><li><span>shp.sayHello(<span class="string">"World"</span><span>);&nbsp;&nbsp;</span></span></li></ol></div><pre style="display: none;" name="code" class="java">		SayHellotoCPP shp = new SayHellotoCPP();
		shp.sayHello("World");</pre>
<p>&nbsp;</p>
<p>我们不让他直接Hello，World。我们把World传进去，执行代码。发现控制台打印出来Hello, World这句话。就此一个最简单的JNI程序已经开发完成。也许有朋友会对CPP代码里的</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Cpp代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=%09const%20char*%20pname%20%3D%20env-%3EGetStringUTFChars(name%2C%20NULL)%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-cpp" start="1"><li><span><span class="keyword">const</span><span>&nbsp;</span><span class="datatypes">char</span><span>*&nbsp;pname&nbsp;=&nbsp;env-&gt;GetStringUTFChars(name,&nbsp;NULL);&nbsp;&nbsp;</span></span></li></ol></div><pre style="display: none;" name="code" class="cpp">	const char* pname = env-&gt;GetStringUTFChars(name, NULL);</pre>
<p>&nbsp;</p>
<p>&nbsp;这句有疑问，这个GetStringUTFChars就是JNI给developer提供的API，我们以后再讲。在这里不得不多句嘴。</p>
<ol><li>因为JNI有一个Native这个特点，一点有项目用了JNI，也就说明这个项目基本不能跨平台了。</li><li>JNI调用是相当慢的，在实际使用的之前一定要先想明白是否有这个必要。</li><li>因为C++和C这样的语言非常灵活，一不小心就容易出错，比如我刚刚的代码就没有写析构字符串释放内存，对于java developer来说因为有了GC 垃圾回收机制，所以大多数人没有写析构函数这样的概念。所以JNI也会增加程序中的风险，增大程序的不稳定性。</li></ol>
		&nbsp;
<br><br><strong><span class="hilite2"></span></strong>其实在Java代码中，除了对本地方法标注native关键字和加上要加载动态链接库之外，<span class="hilite2">JNI</span>基本上是对上层coder透明的，上层coder调用那些本地方法的时候并不知道这个方法的方法体究竟是在哪里，这个道理就像我们用JDK所提供的API一样。所以在Java中使用<span class="hilite2">JNI</span>还是很简单的，相比之下在C++中调用java，就比前者要复杂的多了。
<p>&nbsp;</p>
<p>现在来介绍下<span class="hilite2">JNI</span>里的数据类型。在C++里，编译器会很据所处的平台来为一些基本的
数据类型来分配长度，因此也就造成了平台不一致性，而这个问题在Java中则不存在，因为有JVM的缘故，所以Java中的基本数据类型在所有平台下得到
的都是相同的长度，比如int的宽度永远都是32位。基于这方面的原因，java和c++的基本数据类型就需要实现一些mapping，保持一致性。下面
的表可以概括：</p>
<p>&nbsp;</p>
<table align="center" border="1">
<tbody>
<tr>
<td> &nbsp; &nbsp; Java类型 &nbsp; &nbsp; </td>
<td> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; 本地类型 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; </td>
<td> &nbsp; &nbsp; <span class="hilite2">JNI</span>中定义的别名 &nbsp; &nbsp; </td>
</tr>
<tr>
<td style="text-align: center;">int</td>
<td style="text-align: center;">long</td>
<td style="text-align: center;">jint</td>
</tr>
<tr>
<td style="text-align: center;">long</td>
<td style="text-align: center;">_int64</td>
<td style="text-align: center;">jlong</td>
</tr>
<tr>
<td style="text-align: center;">byte</td>
<td style="text-align: center;">signed char</td>
<td style="text-align: center;">jbyte</td>
</tr>
<tr>
<td style="text-align: center;">boolean</td>
<td style="text-align: center;">unsigned char</td>
<td style="text-align: center;">jboolean</td>
</tr>
<tr>
<td style="text-align: center;">char</td>
<td style="text-align: center;">unsigned short</td>
<td style="text-align: center;">jchar</td>
</tr>
<tr>
<td style="text-align: center;">short</td>
<td style="text-align: center;">short</td>
<td style="text-align: center;">jshort</td>
</tr>
<tr>
<td style="text-align: center;">float</td>
<td style="text-align: center;">float</td>
<td style="text-align: center;">jfloat</td>
</tr>
<tr>
<td style="text-align: center;">double</td>
<td style="text-align: center;">double</td>
<td style="text-align: center;">jdouble</td>
</tr>
<tr>
<td style="text-align: center;">Object</td>
<td style="text-align: center;">_jobject*</td>
<td style="text-align: center;">jobject</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>上面的表格是我在网上搜的，放上来给大家对比一下。对于每一种映射的数据类型，<span class="hilite2">JNI</span>的设计者其实已经帮我们取好了相应的别名以方便记忆。如果想了解一些更加细致的信息，可以去看一些<span class="hilite2">jni</span>.h这个头文件，各种数据类型的定义以及别名就被定义在这个文件中。</p>
<p>&nbsp;</p>
<p>了解了<span class="hilite2">JNI</span>中的数据类型，下面就来看这次的例子。这次我们用Java来实现一个前端的market（以下就用Foreground代替）用CPP来实现一个后端factory（以下用backend代替）。我们首先还是来编写包含本地方法的java类。</p>
<p>&nbsp;</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Java代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=package%20com.chnic.service%3B%0A%0Aimport%20com.chnic.bean.Order%3B%0A%0Apublic%20class%20Business%20%7B%0A%09static%7B%0A%09%09System.loadLibrary(%22FruitFactory%22)%3B%0A%09%7D%0A%09%0A%09public%20Business()%7B%0A%09%09%0A%09%7D%0A%09%0A%09public%20native%20double%20getPrice(String%20name)%3B%0A%09public%20native%20Order%20getOrder(String%20name%2C%20int%20amount)%3B%0A%09public%20native%20Order%20getRamdomOrder()%3B%0A%09public%20native%20void%20analyzeOrder(Order%20order)%3B%0A%09%0A%09public%20void%20notification()%7B%0A%09%09System.out.println(%22Got%20a%20notification.%22)%3B%0A%09%7D%0A%09%0A%09public%20static%20void%20notificationByStatic()%7B%0A%09%09System.out.println(%22Got%20a%20notification%20in%20a%20static%20method.%22)%3B%0A%09%7D%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-j" start="1"><li><span><span class="keyword">package</span><span>&nbsp;com.chnic.service;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;com.chnic.bean.Order;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;Business&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.loadLibrary(<span class="string">"FruitFactory"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;Business(){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">native</span><span>&nbsp;</span><span class="keyword">double</span><span>&nbsp;getPrice(String&nbsp;name);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">native</span><span>&nbsp;Order&nbsp;getOrder(String&nbsp;name,&nbsp;</span><span class="keyword">int</span><span>&nbsp;amount);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">native</span><span>&nbsp;Order&nbsp;getRamdomOrder();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">native</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;analyzeOrder(Order&nbsp;order);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;notification(){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string">"Got&nbsp;a&nbsp;notification."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;notificationByStatic(){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string">"Got&nbsp;a&nbsp;notification&nbsp;in&nbsp;a&nbsp;static&nbsp;method."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="java">package com.chnic.service;

import com.chnic.bean.Order;

public class Business {
	static{
		System.loadLibrary("FruitFactory");
	}
	
	public Business(){
		
	}
	
	public native double getPrice(String name);
	public native Order getOrder(String name, int amount);
	public native Order getRamdomOrder();
	public native void analyzeOrder(Order order);
	
	public void notification(){
		System.out.println("Got a notification.");
	}
	
	public static void notificationByStatic(){
		System.out.println("Got a notification in a static method.");
	}
}</pre>
&nbsp;
<p>这个类里面包含4个本地方法，一个静态初始化块加载将要生成的dll文件。剩下的方法都是很普通的java方法，等会在backend中回调这些方法。这个类需要一个名为Order的JavaBean。</p>
<p>&nbsp;</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Java代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=package%20com.chnic.bean%3B%0A%0Apublic%20class%20Order%20%7B%0A%09%0A%09private%20String%20name%20%3D%20%22Fruit%22%3B%0A%09private%20double%20price%3B%0A%09private%20int%20amount%20%3D%2030%3B%0A%09%0A%09public%20Order()%7B%0A%09%09%0A%09%7D%0A%0A%09public%20int%20getAmount()%20%7B%0A%09%09return%20amount%3B%0A%09%7D%0A%20%0A%09public%20void%20setAmount(int%20amount)%20%7B%0A%09%09this.amount%20%3D%20amount%3B%0A%09%7D%0A%0A%09public%20String%20getName()%20%7B%0A%09%09return%20name%3B%0A%09%7D%0A%0A%09public%20void%20setName(String%20name)%20%7B%0A%09%09this.name%20%3D%20name%3B%0A%09%7D%0A%0A%09public%20double%20getPrice()%20%7B%0A%09%09return%20price%3B%0A%09%7D%0A%0A%09public%20void%20setPrice(double%20price)%20%7B%0A%09%09this.price%20%3D%20price%3B%0A%09%7D%0A%7D%0A" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-j" start="1"><li><span><span class="keyword">package</span><span>&nbsp;com.chnic.bean;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;Order&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;name&nbsp;=&nbsp;</span><span class="string">"Fruit"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">double</span><span>&nbsp;price;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;amount&nbsp;=&nbsp;</span><span class="number">30</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;Order(){&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getAmount()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;amount;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setAmount(</span><span class="keyword">int</span><span>&nbsp;amount)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.amount&nbsp;=&nbsp;amount;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getName()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;name;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setName(String&nbsp;name)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.name&nbsp;=&nbsp;name;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">double</span><span>&nbsp;getPrice()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;price;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setPrice(</span><span class="keyword">double</span><span>&nbsp;price)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.price&nbsp;=&nbsp;price;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="java">package com.chnic.bean;

public class Order {
	
	private String name = "Fruit";
	private double price;
	private int amount = 30;
	
	public Order(){
		
	}

	public int getAmount() {
		return amount;
	}
 
	public void setAmount(int amount) {
		this.amount = amount;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public double getPrice() {
		return price;
	}

	public void setPrice(double price) {
		this.price = price;
	}
}
</pre>
<p>&nbsp;</p>
<p>JavaBean中，我们为两个私有属性赋值，方便后面的例子演示。到此为止除了测试代码之外的Java端的代码就全部高调了，接下来进行生成.h
头文件、建立C++工程的工作，在这里就一笔带过，不熟悉的朋友请回头看第一篇。在工程里我们新建一个名为Foctory的C++ source
file 文件，去实现那些native方法。具体的代码如下。</p>
<p>&nbsp;</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Cpp代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=%23include%20%3Ciostream.h%3E%0A%23include%20%3Cstring.h%3E%0A%23include%20%22com_chnic_service_Business.h%22%0A%0Ajobject%20getInstance(JNIEnv*%20env%2C%20jclass%20obj_class)%3B%0A%0AJNIEXPORT%20jdouble%20JNICALL%20Java_com_chnic_service_Business_getPrice(JNIEnv*%20env%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20%20%20jobject%20obj%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20%20%20jstring%20name)%0A%7B%0A%09const%20char*%20pname%20%3D%20env-%3EGetStringUTFChars(name%2C%20NULL)%3B%0A%09cout%20%3C%3C%20%22Before%20release%3A%20%22%20%20%3C%3C%20pname%20%3C%3C%20endl%3B%0A%0A%09if%20(strcmp(pname%2C%20%22Apple%22)%20%3D%3D%200)%0A%09%7B%0A%09%09env-%3EReleaseStringUTFChars(name%2C%20pname)%3B%0A%09%09cout%20%3C%3C%20%22After%20release%3A%20%22%20%3C%3C%20pname%20%3C%3C%20endl%3B%0A%09%09return%201.2%3B%0A%09%7D%20%0A%09else%0A%09%7B%0A%09%09env-%3EReleaseStringUTFChars(name%2C%20pname)%3B%0A%09%09cout%20%3C%3C%20%22After%20release%3A%20%22%20%3C%3C%20pname%20%3C%3C%20endl%3B%0A%09%09return%202.1%3B%0A%09%7D%09%0A%7D%0A%0A%0AJNIEXPORT%20jobject%20JNICALL%20Java_com_chnic_service_Business_getOrder(JNIEnv*%20env%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20%20%20jobject%20obj%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20%20%20jstring%20name%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20%20%20jint%20amount)%0A%7B%0A%09jclass%20order_class%20%3D%20env-%3EFindClass(%22com%2Fchnic%2Fbean%2FOrder%22)%3B%0A%09jobject%20order%20%3D%20getInstance(env%2C%20order_class)%3B%0A%09%0A%09jmethodID%20setName_method%20%3D%20env-%3EGetMethodID(order_class%2C%20%22setName%22%2C%20%22(Ljava%2Flang%2FString%3B)V%22)%3B%0A%09env-%3ECallVoidMethod(order%2C%20setName_method%2C%20name)%3B%0A%0A%09jmethodID%20setAmount_method%20%3D%20env-%3EGetMethodID(order_class%2C%20%22setAmount%22%2C%20%22(I)V%22)%3B%0A%09env-%3ECallVoidMethod(order%2C%20setAmount_method%2C%20amount)%3B%0A%0A%09return%20order%3B%0A%7D%0A%0AJNIEXPORT%20jobject%20JNICALL%20Java_com_chnic_service_Business_getRamdomOrder(JNIEnv*%20env%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20jobject%20obj)%0A%7B%0A%09jclass%20business_class%20%3D%20env-%3EGetObjectClass(obj)%3B%0A%09jobject%20business_obj%20%3D%20getInstance(env%2C%20business_class)%3B%0A%0A%09jmethodID%20notification_method%20%3D%20env-%3EGetMethodID(business_class%2C%20%22notification%22%2C%20%22()V%22)%3B%0A%09env-%3ECallVoidMethod(obj%2C%20notification_method)%3B%0A%0A%09jclass%20order_class%20%3D%20env-%3EFindClass(%22com%2Fchnic%2Fbean%2FOrder%22)%3B%0A%09jobject%20order%20%3D%20getInstance(env%2C%20order_class)%3B%0A%09jfieldID%20amount_field%20%3D%20env-%3EGetFieldID(order_class%2C%20%22amount%22%2C%20%22I%22)%3B%0A%09jint%20amount%20%3D%20env-%3EGetIntField(order%2C%20amount_field)%3B%0A%09cout%20%3C%3C%20%22amount%3A%20%22%20%3C%3C%20amount%20%3C%3C%20endl%3B%0A%09return%20order%3B%0A%7D%0A%0A%0AJNIEXPORT%20void%20JNICALL%20Java_com_chnic_service_Business_analyzeOrder%20(JNIEnv*%20env%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20jclass%20cls%2C%20%0A%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%09%20jobject%20obj)%0A%7B%0A%09jclass%20order_class%20%3D%20env-%3EGetObjectClass(obj)%3B%0A%09jmethodID%20getName_method%20%3D%20env-%3EGetMethodID(order_class%2C%20%22getName%22%2C%20%22()Ljava%2Flang%2FString%3B%22)%3B%0A%09jstring%20name_str%20%3D%20static_cast%3Cjstring%3E(env-%3ECallObjectMethod(obj%2C%20getName_method))%3B%0A%09const%20char*%20pname%20%3D%20env-%3EGetStringUTFChars(name_str%2C%20NULL)%3B%0A%0A%09cout%20%3C%3C%20%22Name%20in%20Java_com_chnic_service_Business_analyzeOrder%3A%20%22%20%3C%3C%20pname%20%3C%3C%20endl%3B%0A%09jmethodID%20notification_method_static%20%3D%20env-%3EGetStaticMethodID(cls%2C%20%22notificationByStatic%22%2C%20%22()V%22)%3B%0A%09env-%3ECallStaticVoidMethod(cls%2C%20notification_method_static)%3B%0A%0A%7D%0A%0Ajobject%20getInstance(JNIEnv*%20env%2C%20jclass%20obj_class)%0A%7B%0A%09jmethodID%20construction_id%20%3D%20env-%3EGetMethodID(obj_class%2C%20%22%3Cinit%3E%22%2C%20%22()V%22)%3B%0A%09jobject%20obj%20%3D%20env-%3ENewObject(obj_class%2C%20construction_id)%3B%0A%09return%20obj%3B%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-cpp" start="1"><li><span><span class="preprocessor">#include&nbsp;&lt;iostream.h&gt;</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="preprocessor">#include&nbsp;&lt;string.h&gt;</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="preprocessor">#include&nbsp;"com_chnic_service_Business.h"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>jobject&nbsp;getInstance(JNIEnv*&nbsp;env,&nbsp;jclass&nbsp;obj_class);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>JNIEXPORT&nbsp;jdouble&nbsp;JNICALL&nbsp;Java_com_chnic_service_Business_getPrice(JNIEnv*&nbsp;env,&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;obj,&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jstring&nbsp;name)&nbsp;&nbsp;</span></li><li><span>{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span><span>&nbsp;</span><span class="datatypes">char</span><span>*&nbsp;pname&nbsp;=&nbsp;env-&gt;GetStringUTFChars(name,&nbsp;NULL);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;<span class="string">"Before&nbsp;release:&nbsp;"</span><span>&nbsp;&nbsp;&lt;&lt;&nbsp;pname&nbsp;&lt;&lt;&nbsp;endl;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(strcmp(pname,&nbsp;</span><span class="string">"Apple"</span><span>)&nbsp;==&nbsp;0)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env-&gt;ReleaseStringUTFChars(name,&nbsp;pname);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;<span class="string">"After&nbsp;release:&nbsp;"</span><span>&nbsp;&lt;&lt;&nbsp;pname&nbsp;&lt;&lt;&nbsp;endl;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;1.2;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env-&gt;ReleaseStringUTFChars(name,&nbsp;pname);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;<span class="string">"After&nbsp;release:&nbsp;"</span><span>&nbsp;&lt;&lt;&nbsp;pname&nbsp;&lt;&lt;&nbsp;endl;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;2.1;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>JNIEXPORT&nbsp;jobject&nbsp;JNICALL&nbsp;Java_com_chnic_service_Business_getOrder(JNIEnv*&nbsp;env,&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;obj,&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jstring&nbsp;name,&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jint&nbsp;amount)&nbsp;&nbsp;</span></li><li><span>{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jclass&nbsp;order_class&nbsp;=&nbsp;env-&gt;FindClass(<span class="string">"com/chnic/bean/Order"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;order&nbsp;=&nbsp;getInstance(env,&nbsp;order_class);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jmethodID&nbsp;setName_method&nbsp;=&nbsp;env-&gt;<span class="hilite1">GetMethodID</span>(order_class,&nbsp;<span class="string">"setName"</span><span>,&nbsp;</span><span class="string">"(Ljava/lang/String;)V"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;env-&gt;CallVoidMethod(order,&nbsp;setName_method,&nbsp;name);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jmethodID&nbsp;setAmount_method&nbsp;=&nbsp;env-&gt;<span class="hilite1">GetMethodID</span>(order_class,&nbsp;<span class="string">"setAmount"</span><span>,&nbsp;</span><span class="string">"(I)V"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;env-&gt;CallVoidMethod(order,&nbsp;setAmount_method,&nbsp;amount);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;order;&nbsp;&nbsp;</span></span></li><li><span>}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>JNIEXPORT&nbsp;jobject&nbsp;JNICALL&nbsp;Java_com_chnic_service_Business_getRamdomOrder(JNIEnv*&nbsp;env,&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;obj)&nbsp;&nbsp;</span></li><li><span>{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jclass&nbsp;business_class&nbsp;=&nbsp;env-&gt;GetObjectClass(obj);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;business_obj&nbsp;=&nbsp;getInstance(env,&nbsp;business_class);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jmethodID&nbsp;notification_method&nbsp;=&nbsp;env-&gt;<span class="hilite1">GetMethodID</span>(business_class,&nbsp;<span class="string">"notification"</span><span>,&nbsp;</span><span class="string">"()V"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;env-&gt;CallVoidMethod(obj,&nbsp;notification_method);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jclass&nbsp;order_class&nbsp;=&nbsp;env-&gt;FindClass(<span class="string">"com/chnic/bean/Order"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;order&nbsp;=&nbsp;getInstance(env,&nbsp;order_class);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jfieldID&nbsp;amount_field&nbsp;=&nbsp;env-&gt;GetFieldID(order_class,&nbsp;<span class="string">"amount"</span><span>,&nbsp;</span><span class="string">"I"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jint&nbsp;amount&nbsp;=&nbsp;env-&gt;GetIntField(order,&nbsp;amount_field);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;<span class="string">"amount:&nbsp;"</span><span>&nbsp;&lt;&lt;&nbsp;amount&nbsp;&lt;&lt;&nbsp;endl;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;order;&nbsp;&nbsp;</span></span></li><li><span>}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>JNIEXPORT&nbsp;<span class="keyword">void</span><span>&nbsp;JNICALL&nbsp;Java_com_chnic_service_Business_analyzeOrder&nbsp;(JNIEnv*&nbsp;env,&nbsp;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jclass&nbsp;cls,&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;obj)&nbsp;&nbsp;</span></li><li><span>{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jclass&nbsp;order_class&nbsp;=&nbsp;env-&gt;GetObjectClass(obj);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jmethodID&nbsp;getName_method&nbsp;=&nbsp;env-&gt;<span class="hilite1">GetMethodID</span>(order_class,&nbsp;<span class="string">"getName"</span><span>,&nbsp;</span><span class="string">"()Ljava/lang/String;"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jstring&nbsp;name_str&nbsp;=&nbsp;<span class="keyword">static_cast</span><span>&lt;jstring&gt;(env-&gt;CallObjectMethod(obj,&nbsp;getName_method));&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span><span>&nbsp;</span><span class="datatypes">char</span><span>*&nbsp;pname&nbsp;=&nbsp;env-&gt;GetStringUTFChars(name_str,&nbsp;NULL);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;<span class="string">"Name&nbsp;in&nbsp;Java_com_chnic_service_Business_analyzeOrder:&nbsp;"</span><span>&nbsp;&lt;&lt;&nbsp;pname&nbsp;&lt;&lt;&nbsp;endl;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jmethodID&nbsp;notification_method_static&nbsp;=&nbsp;env-&gt;GetStaticMethodID(cls,&nbsp;<span class="string">"notificationByStatic"</span><span>,&nbsp;</span><span class="string">"()V"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;env-&gt;CallStaticVoidMethod(cls,&nbsp;notification_method_static);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>jobject&nbsp;getInstance(JNIEnv*&nbsp;env,&nbsp;jclass&nbsp;obj_class)&nbsp;&nbsp;</span></li><li><span>{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jmethodID&nbsp;construction_id&nbsp;=&nbsp;env-&gt;<span class="hilite1">GetMethodID</span>(obj_class,&nbsp;<span class="string">"&lt;init&gt;"</span><span>,&nbsp;</span><span class="string">"()V"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;jobject&nbsp;obj&nbsp;=&nbsp;env-&gt;NewObject(obj_class,&nbsp;construction_id);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;obj;&nbsp;&nbsp;</span></span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="cpp">#include &lt;iostream.h&gt;
#include &lt;string.h&gt;
#include "com_chnic_service_Business.h"

jobject getInstance(JNIEnv* env, jclass obj_class);

JNIEXPORT jdouble JNICALL Java_com_chnic_service_Business_getPrice(JNIEnv* env, 
																   jobject obj, 
																   jstring name)
{
	const char* pname = env-&gt;GetStringUTFChars(name, NULL);
	cout &lt;&lt; "Before release: "  &lt;&lt; pname &lt;&lt; endl;

	if (strcmp(pname, "Apple") == 0)
	{
		env-&gt;ReleaseStringUTFChars(name, pname);
		cout &lt;&lt; "After release: " &lt;&lt; pname &lt;&lt; endl;
		return 1.2;
	} 
	else
	{
		env-&gt;ReleaseStringUTFChars(name, pname);
		cout &lt;&lt; "After release: " &lt;&lt; pname &lt;&lt; endl;
		return 2.1;
	}	
}


JNIEXPORT jobject JNICALL Java_com_chnic_service_Business_getOrder(JNIEnv* env, 
																   jobject obj, 
																   jstring name, 
																   jint amount)
{
	jclass order_class = env-&gt;FindClass("com/chnic/bean/Order");
	jobject order = getInstance(env, order_class);
	
	jmethodID setName_method = env-&gt;<span class="hilite1">GetMethodID</span>(order_class, "setName", "(Ljava/lang/String;)V");
	env-&gt;CallVoidMethod(order, setName_method, name);

	jmethodID setAmount_method = env-&gt;<span class="hilite1">GetMethodID</span>(order_class, "setAmount", "(I)V");
	env-&gt;CallVoidMethod(order, setAmount_method, amount);

	return order;
}

JNIEXPORT jobject JNICALL Java_com_chnic_service_Business_getRamdomOrder(JNIEnv* env, 
																		 jobject obj)
{
	jclass business_class = env-&gt;GetObjectClass(obj);
	jobject business_obj = getInstance(env, business_class);

	jmethodID notification_method = env-&gt;<span class="hilite1">GetMethodID</span>(business_class, "notification", "()V");
	env-&gt;CallVoidMethod(obj, notification_method);

	jclass order_class = env-&gt;FindClass("com/chnic/bean/Order");
	jobject order = getInstance(env, order_class);
	jfieldID amount_field = env-&gt;GetFieldID(order_class, "amount", "I");
	jint amount = env-&gt;GetIntField(order, amount_field);
	cout &lt;&lt; "amount: " &lt;&lt; amount &lt;&lt; endl;
	return order;
}


JNIEXPORT void JNICALL Java_com_chnic_service_Business_analyzeOrder (JNIEnv* env, 
																	 jclass cls, 
																	 jobject obj)
{
	jclass order_class = env-&gt;GetObjectClass(obj);
	jmethodID getName_method = env-&gt;<span class="hilite1">GetMethodID</span>(order_class, "getName", "()Ljava/lang/String;");
	jstring name_str = static_cast&lt;jstring&gt;(env-&gt;CallObjectMethod(obj, getName_method));
	const char* pname = env-&gt;GetStringUTFChars(name_str, NULL);

	cout &lt;&lt; "Name in Java_com_chnic_service_Business_analyzeOrder: " &lt;&lt; pname &lt;&lt; endl;
	jmethodID notification_method_static = env-&gt;GetStaticMethodID(cls, "notificationByStatic", "()V");
	env-&gt;CallStaticVoidMethod(cls, notification_method_static);

}

jobject getInstance(JNIEnv* env, jclass obj_class)
{
	jmethodID construction_id = env-&gt;<span class="hilite1">GetMethodID</span>(obj_class, "&lt;init&gt;", "()V");
	jobject obj = env-&gt;NewObject(obj_class, construction_id);
	return obj;
}</pre>
&nbsp;
<p>可以看到，在我Java中的四个本地方法在这里全部被实现，接下来针对这四个方法来解释下，一些<span class="hilite2">JNI</span>相关的API的使用方法。先从第一个方法讲起吧：</p>
<p>&nbsp;</p>
<p><strong>1.getPrice(String name)</strong>
</p>
<p>&nbsp;</p>
<p>这个方法是从foreground传递一个类型为string的参数到backend，然后backend判断返回相应的价格。在cpp的代码中，
我们用GetStringUTFChars这个方法来把传来的jstring变成一个UTF-8编码的char型字符串。因为jstring的实际类型是
jobject，所以无法直接比较。</p>
<p>GetStringUTFChars方法包含两个参数，第一参数是你要处理的jstring对象，第二个参数是否需要在内存中生成一个副本对象。将
jstring转换成为了一个const
char*了之后，我们用string.h中带strcmp函数来比较这两个字符串，如果传来的字符串是“Apple”的话我们返回1.2。反之返回
2.1。在这里还要多说一下ReleaseStringUTFChars这个函数，这个函数从字面上不难理解，就是释放内存用的。有点像cpp里的析构函
数，只不过Sun帮我们已经封装好了。由于在JVM中有GC这个东东，所以多数java coder并没有写析构的习惯，不过在<span class="hilite2">JNI</span>里是必须的了，否则容易造成内存泄露。我们在这里在release之前和之后分别打出这个字符串来看一下效果。</p>
<p>&nbsp;</p>
<p>粗略的解释完一些API之后，我们编写测试代码。</p>
<p>&nbsp;</p>
<div class="dp-highlighter"><div class="bar"><div class="tools">Java代码 <embed src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/clipboard_new.swf" flashvars="clipboard=%09%09Business%20b%20%3D%20new%20Business()%3B%09%09%0A%09%09System.out.println(b.getPrice(%22Apple%22))%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="15" width="14"></div></div><ol class="dp-j" start="1"><li><span><span>Business&nbsp;b&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;Business();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li><span>System.out.println(b.getPrice(<span class="string">"Apple"</span><span>));&nbsp;&nbsp;</span></span></li></ol></div><pre style="display: none;" name="code" class="java">		Business b = new Business();		
		System.out.println(b.getPrice("Apple"));</pre>
&nbsp;
<p>运行这段测试代码，控制台上打出</p>
<p>&nbsp;</p>
<p>Before release: Apple<br>
After release: </p></div>
</div>
<div class="cont5">
<div class="t">博客推荐文章</div>
<ul>
<li><a href="http://blog.chinaunix.net/uid-9688646-id-3297478.html">linux-kernel调试技术大全</a>  (18分钟前)</li>
<li><a href="http://blog.chinaunix.net/uid-26285146-id-3297461.html">lseek()</a>  (24分钟前)</li>
<li><a href="http://blog.chinaunix.net/uid-8550681-id-3297451.html">Linux中的模式切换和寻址管理</a>  (26分钟前)</li>
<li><a href="http://blog.chinaunix.net/uid-8550681-id-3297448.html">内核比较: 2.6 内核中改进了内存管理</a>  (27分钟前)</li>
<li><a href="http://blog.chinaunix.net/uid-8550681-id-3297445.html">探索 Linux 内存模型</a>  (27分钟前)</li>
	
</ul>
</div>

<div class="cont6">
<!-- 分享 -->
<div class="fx">
<div class="icon">										 
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
<a href="http://www.jiathis.com/share/" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank">分享到：</a>
<a title="分享到新浪微博" class="jiathis_button_tsina"><span class="jiathis_txt jiathis_separator jtico jtico_tsina">新浪微博</span></a>
<a title="分享到QQ空间" class="jiathis_button_qzone"><span class="jiathis_txt jiathis_separator jtico jtico_qzone">QQ空间</span></a>
<a title="分享到开心网" class="jiathis_button_kaixin001"><span class="jiathis_txt jiathis_separator jtico jtico_kaixin001">开心网</span></a>
<a title="分享到豆瓣" class="jiathis_button_douban"><span class="jiathis_txt jiathis_separator jtico jtico_douban">豆瓣</span></a>
<a title="分享到人人网" class="jiathis_button_renren"><span class="jiathis_txt jiathis_separator jtico jtico_renren">人人网</span></a>
<a title="分享到Twitter" class="jiathis_button_twitter"><span class="jiathis_txt jiathis_separator jtico jtico_twitter">twitter</span></a>
<a title="分享到Facebook" class="jiathis_button_fb"><span class="jiathis_txt jiathis_separator jtico jtico_fb">fb</span></a>
</div>
<script type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/jia.js" charset="utf-8"></script><script type="text/javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/plugin.js" charset="utf-8"></script><div style="position:absolute;width:0px;height:0px;"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="JIATHISSWF" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" height="0" width="0"><param name="allowScriptAccess" value="always"><param name="swLiveConnect" value="true"><param name="movie" value="http://www.jiathis.com/code/swf/m.swf"><param name="FlashVars" value="z=a"><embed name="JIATHISSWF" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/m.swf" flashvars="z=a" allowscriptaccess="always" swliveconnect="true" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" height="0" width="0"></object></div>
<!-- JiaThis Button END -->
</div>

<span style="cursor:pointer;">
<a id="support">0</a>
<br>
<a onclick="ajaxmenu(event, this.id,0, 2000, 'doSupport')" id="click_blogid_2135900" href="http://blog.chinaunix.net/cp.php?ac=click&amp;op=add&amp;clickid=4&amp;idtype=blogid&amp;id=2135900&amp;hash=ed766b7726045d7aeaf0bff648003008">
&nbsp;&nbsp;&nbsp;<b>顶</b>
</a>
</span>
<div class="clear"></div>
</div>

                <div class="clear"></div>
<style>
.bor0223{ width:708px; margin:0 auto 20px; height:90px;}
.bor0223_tit{ height:28px; line-height:28px; border-bottom:1px dashed #ccc; font-size:14px; font-weight:bold; padding-left:12px;}
.list0223{ width:698px; margin:10px 0 0 12px;}
.list0223 li{ float:left; width:174px; line-height:20px; height:20px;}
</style><div class="bor0223"><div class="bor0223_tit">热门产品推荐</div><ul class="list0223"><li><a href="http://product.it168.com/detail/doc/485445/index.shtml" target="_blank" title="联想 TS430 S1220 2/2*500O R5KEY">联想 TS430 S1220 2/2*5...</a></li><li><a href="http://product.it168.com/detail/doc/467112/index.shtml" target="_blank" title="IBM System x3850 X5(7143i20)">IBM System x3850 X5(...</a></li><li><a href="http://product.it168.com/detail/doc/485444/index.shtml" target="_blank" title="联想 TS430 S1220 2/500O">联想 TS430 S1220 2/500...</a></li><li><a href="http://product.it168.com/detail/doc/434302/index.shtml" target="_blank" title="IBM System x3650 M3(7945IEI)">IBM System x3650 M3(...</a></li><li><a href="http://product.it168.com/detail/doc/455241/index.shtml" target="_blank" title="IBM System x3500 M3(7380i28)">IBM System x3500 M3(...</a></li><li><a href="http://product.it168.com/detail/doc/459874/index.shtml" target="_blank" title="戴尔 PowerEdge R410(Xeon E5606*2/4GB/500GB*2)">戴尔 PowerEdge R410(Xeo...</a></li><li><a href="http://product.it168.com/detail/doc/465747/index.shtml" target="_blank" title="戴尔 PowerEdge R710(Xeon E5606/2GB/300GB)">戴尔 PowerEdge R710(Xeo...</a></li><li><a href="http://product.it168.com/detail/doc/455672/index.shtml" target="_blank" title="惠普 ProLiant DL160 G6(QP661A)">惠普 ProLiant DL160 G...</a></li></ul></div><!-- 阅读 -->

<div class="read">
<a href="javascript:;">阅读<b>(8598)</b></a>┊ <a href="http://blog.chinaunix.net/space.php?uid=27875&amp;do=blog&amp;id=2135900#comment">评论 <b>(<span id="comm_num">0</span>)</b></a>┊<a href="http://blog.chinaunix.net/cp.php?ac=favorites&amp;op=addfavorites&amp;blogid=2135900" id="a_favorite" onclick="ajaxmenu(event, this.id, 1)">收藏(0)</a>┊<a href="http://blog.chinaunix.net/cp.php?ac=common&amp;op=report&amp;idtype=blogid&amp;id=2135900" id="a_report" onclick="ajaxmenu(event, this.id, 1)">举报</a>┊<a href="javascript:window.print();">打印</a>
</div>

<div class="next1">前一篇：<a href="http://blog.chinaunix.net/uid-27875-id-2135899.html">基础库-libxplc</a></div>

<!-- 评论 -->
<div class="tit8" id="comment_dv" style="display: none;">
<span><a href="#comment">[发评论]</a></span>
<b>评论</b>&nbsp;重要提示：警惕虚假中奖信息!
</div>
<div id="comment" class="comments_list">
<div class="box_content">
<ul class="post_list a_list justify_list" id="comment_ul">
</ul>
</div>
</div>
<div class="clear"></div>

<!-- 发评论 -->
<div class="logins">亲，您还没有登录,请<a href="http://blog.chinaunix.net/do.php?ac=wuxingzypcw213">[登录]</a>或<a href="http://blog.chinaunix.net/do.php?ac=8f442ba1e0c79cd3efcd1fd42b8aad8e">[注册]</a>后再进行评论</div>
</div>
</div>
 <!-- 徽章定位1 -->
 </div>

<div class="clear"></div>
</div>
<script type="text/javascript">
<!--
var blogid = 2135900;
var bloguid = 0;
function doSupport(){
var x = new Ajax();
x.get('do.php?ac=ajax&op=support&id='+blogid , function(s){
document.getElementById('support').innerHTML = s;
});
}

function code_hide(id){
var code = document.getElementById(id).style.display;
if(code == 'none'){
document.getElementById(id).style.display = 'block';
}else{
document.getElementById(id).style.display = 'none';
}
}


function checkComment(id){

//	if(bloguid < 1 &&  ($('nim').checked == false) ){
//		alert('请选择匿名发表评论！');
//		return false;
//	}
if(trim($('seccode').value) == ''){
alert('验证码不能为空！');
return false;
}
s('comment_dv');
ajaxpost('quickcommentform_'+id, 'comment_add');
$('seccode').value = '';

var img = '/do.php?ac=seccode&rand='+Math.random();
$('img_seccode').src = img;
}
$('font_14').style.fontWeight='bold';
function doZoom(s){
$('font_12').style.fontWeight='normal';
$('font_14').style.fontWeight='normal';
$('font_16').style.fontWeight='normal';
$('font_'+s).style.fontWeight='bold';
s = s + 'px';
$('detail').style.fontSize = s;
}
function setTop(t , id)
{
var x = new Ajax();
x.get('/admin.php?ac=blog&op='+ t +'&id='+id , function(s){
if(t == 'retop'){
document.getElementById('top_' + id).innerHTML = "<a href=\"javascript:;\" onclick=\"setTop('top', '"+id+"');\">&nbsp;置顶首页</a>";
}else{
document.getElementById('top_' + id).innerHTML = "<a href=\"javascript:;\" onclick=\"setTop('retop', '"+id+"');\">&nbsp;取消置顶</a>";
}
});
}

var FmId = 2;

function attention(uid , t){
if(uid){
var x = new Ajax();
x.get('/cp.php?ac=attention&op='+ t +'&uid=' + uid , function(s){
if(t == 'add'){

var h = "<a href='javascript:;' onclick='attention(\""+ uid +"\" , \"delete\");'>取消关注</a>";
document.getElementById('attention').innerHTML = h;
}else{
var h = "<a href='javascript:;' onclick='attention(\""+ uid +"\" , \"add\");'>加关注</a>";
document.getElementById('attention').innerHTML = h;
}
});
}
}
//-->
</script>
<div id="footer">
<div class="l">
<a href="http://www.chinaunix.net/about/index.shtml" rel="nofollow">关于我们</a> | 
<a href="http://www.it168.com/bottomfile/it168.shtml" rel="nofollow">关于IT168</a> | 
<a href="http://www.chinaunix.net/about/connect.html" rel="nofollow">联系方式</a> | 
<a href="http://www.chinaunix.net/about/service.html" rel="nofollow">广告合作</a> | 
<a href="http://blog.chinaunix.net/about/fl.html" rel="nofollow">法律声明</a> | 
<a href="http://blog.chinaunix.net/register.php" rel="nofollow">免费注册</a> 
<address>
Copyright &#169; 2001-2010 ChinaUnix.net All Rights Reserved 北京皓辰网域网络信息技术有限公司. 版权所有 
</address>
</div>
<div class="r">
感谢所有关心和支持过ChinaUnix的朋友们<br>京ICP证041476号 京ICP证060528号
</div>
<div class="clear"></div>
</div>
<div id="dialogBoxShadow" style="display:none;z-index:49;"></div>
<input id="dot" value="" type="hidden">
<script type="text/javascript">

<!--
if($('dot').value == 'theme')  getPageSet();
function checkHtitle(){
var tt = $('spacetitle').value;
if(ttlen(trim(tt)) > 48){
alert('博客宣言不能超过48个字符！');
return false;
}
ajaxpost('home_from','homeTitle');
}
function checkBbrief(){
var tt = $('blog_brief').value;
if(ttlen(trim(tt)) > 200){
alert('个性签名不能超过200个字符！');
return false;
}
ajaxpost('brief_form','blogBrief');
}
function homeTitle()
{
var spacetitle_value = $('spacetitle').value;
if(!spacetitle_value){
spacetitle_value = '还没有博客宣言';
}
var x = new Ajax();
x.get('/do.php?ac=ajax&op=htl', function(s){
document.getElementById('home_t').innerHTML = s
});
s('home_title');
h('home_title_form');
}
function blogBrief()
{
var spacetitle_value = $('blog_brief').value;
if(!spacetitle_value){
spacetitle_value = '还没有个性签名';
}
var x = new Ajax();
x.get('/do.php?ac=ajax&op=bbf', function(s){
document.getElementById('blog_b').innerHTML = s
});
s('blog_brief');
h('blog_brief_form');
}
//-->
</script>
<script language="javascript" src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/pv.js"></script>
<script type="text/javascript">
    function sendPV(){
        var pvTrack = new PvTrack();
        pvTrack.type = 35; // 频道类别ID
        pvTrack.channel = 189; // 频道ID
        pvTrack.pageType = 0;
        pvTrack.track();
    }
    window.setTimeout("sendPV()", 0); 

</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20237423-2']);
  _gaq.push(['_setDomainName', '.chinaunix.net']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<div style="display:none">
<script type="text/javascript"> 
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F0ee5e8cdc4d43389b3d1bfd76e83216b' type='text/javascript'%3E%3C/script%3E"));
</script><script src="JNI%E7%BC%96%E7%A8%8B%20%E2%80%94%E2%80%94%20%E8%AE%A9C++%E5%92%8CJava%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8_java%E8%B0%83%E7%94%A8dll_files/h.js" type="text/javascript"></script>
</div>

 

</body></html>